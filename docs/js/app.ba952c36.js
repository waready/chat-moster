(function(e){function t(t){for(var n,o,s=t[0],c=t[1],u=t[2],d=0,f=[];d<s.length;d++)o=s[d],r[o]&&f.push(r[o][0]),r[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);l&&l(t);while(f.length)f.shift()();return i.push.apply(i,u||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,s=1;s<a.length;s++){var c=a[s];0!==r[c]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var n={},r={app:0},i=[];function o(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=n,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("1356"),r=a.n(n);r.a},1356:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var n=a("2b0e"),r=a("bb71");a("da64");n["a"].use(r["a"],{theme:{primary:"#3C638D",secondary:"#696389",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"},options:{customProperties:!0},iconfont:"md"});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-toolbar",{attrs:{app:"",color:"primary",dark:""}},[a("v-toolbar-title",{staticClass:"headline moster-fond"},[e._v("\n      Moster Chat\n    ")]),a("v-spacer"),e.usuario?a("v-layout",{attrs:{"align-center":"","justify-end":""}},[a("v-avatar",{attrs:{size:"40",color:"white"}},[a("v-img",{attrs:{src:e.usuario.url}})],1),a("span",{staticClass:"ml-3 moster-fond"},[e._v("\n          "+e._s(e.usuario.nombre)+"\n        ")]),a("v-btn",{staticClass:"moster-fond",attrs:{flat:"",small:""},on:{click:function(t){e.usuario=null}}},[e._v("Salir")])],1):e._e()],1),a("v-content",[a("v-container",{staticClass:"fondo",attrs:{fluid:"","fill-height":""}},[e.usuario?a("chat",{attrs:{usuario:e.usuario},on:{onNotificacion:e.mostarNotificacion}}):a("login",{on:{onNotificacion:e.mostarNotificacion,onIngresar:e.ingresar}})],1)],1),a("v-snackbar",{attrs:{color:e.notificacion.color,"multi-line":"",top:"",timeout:6e3,dark:""},model:{value:e.notificacion.visible,callback:function(t){e.$set(e.notificacion,"visible",t)},expression:"notificacion.visible"}},[a("span",[e._v(" "+e._s(e.notificacion.mensaje))]),a("v-btn",{attrs:{color:"white",flat:""},on:{click:function(t){e.notificacion.visible=!1}}},[e._v("\n      Cerrar\n    ")])],1),a("v-footer",{attrs:{color:"primary",dark:""}},[a("v-layout",{attrs:{"justify-center":"","align-center":""}},[a("span",{staticClass:"justify-center"},[e._v("\n        @Moster chat - Antony Japura - Desarrollo web\n      ")])])],1)],1)},o=[],s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-layout",{attrs:{"justify-center":"","align-center":""}},[a("v-flex",{attrs:{xs12:"",sm8:"",md6:"",lg5:"",xl4:""}},[a("v-card",[a("v-toolbar",{attrs:{color:"primary",dark:"",card:""}},[a("v-toolbar-title",[e._v("\n                    Ingrensa tu Email y Contraseña\n                ")])],1),a("v-card-text",[a("v-text-field",{attrs:{autofocus:"",label:"Email",id:"id"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-text-field",{attrs:{label:"¨Password",id:"id"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.ingresar()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),a("v-card-text",[a("v-layout",{attrs:{"justify-end":""}},[a("v-btn",{attrs:{color:"secondary"},on:{click:function(t){return e.ingresar()}}},[e._v("\n                        Ingresar\n                    ")])],1)],1)],1)],1)],1)},c=[],u=(a("96cf"),a("3b8d")),l=a("c23d"),d=a.n(l);a("ea7b"),a("e71f");var f={apiKey:"AIzaSyAnMvfTP1KHGosU_Vl3pE6a7Yn0T5m52VY",authDomain:"moster-chat-8da0e.firebaseapp.com",databaseURL:"https://moster-chat-8da0e.firebaseio.com",projectId:"moster-chat-8da0e",storageBucket:"moster-chat-8da0e.appspot.com",messagingSenderId:"692275694614",appId:"1:692275694614:web:6f6f2dfae192958a"};d.a.initializeApp(f);var v=d.a.auth(),h=d.a.firestore(),p={data:function(){return{email:"soliban@mail.com",password:"123456"}},methods:{ingresar:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.email){e.next=3;break}return this.enviarNotificacion("Deves colocar un email","warning"),e.abrupt("return");case 3:if(this.email){e.next=6;break}return this.enviarNotificacion("Deves colocar tu password","warning"),e.abrupt("return");case 6:return e.prev=6,e.next=9,v.signInWithEmailAndPassword(this.email,this.password);case 9:if(!v.currentUser){e.next=15;break}return t=v.currentUser.uid,e.next=13,h.collection("usuarios").doc(t).get();case 13:a=e.sent,a.exists?(n=a.data(),this.$emit("onIngresar",n)):this.enviarNotificacion("no se encontro la informacion del usuario","error");case 15:e.next=26;break;case 17:e.prev=17,e.t0=e["catch"](6),e.t1=e.t0.code,e.next="auth/user-not-found"===e.t1?22:"auth/wrong-password"===e.t1?22:24;break;case 22:return this.enviarNotificacion("usuario no valido, revisa tu correro y contraseña","warning"),e.abrupt("break",26);case 24:return this.enviarNotificacion("Ocurrio un error verificando la informacion","error"),e.abrupt("break",26);case 26:case"end":return e.stop()}},e,this,[[6,17]])}));function t(){return e.apply(this,arguments)}return t}(),enviarNotificacion:function(e,t){this.$emit("onNotificacion",{mensaje:e,color:t})}}},m=p,b=a("2877"),g=a("6544"),x=a.n(g),y=a("8336"),j=a("b0af"),k=a("99d9"),w=a("0e8f"),C=a("a722"),_=a("2677"),V=a("71d9"),M=a("2a7f"),T=Object(b["a"])(m,s,c,!1,null,null,null),S=T.exports;x()(T,{VBtn:y["a"],VCard:j["a"],VCardText:k["a"],VFlex:w["a"],VLayout:C["a"],VTextField:_["a"],VToolbar:V["a"],VToolbarTitle:M["a"]});var L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-layout",{directives:[{name:"resize",rawName:"v-resize",value:e.onRisize,expression:"onRisize"}]},[e.mostrarLista?a("v-flex",{staticClass:"usuarios",attrs:{xs12:"",sm4:"",lg4:""}},[a("v-card",[a("v-toolbar",{attrs:{color:"primary",card:"",dark:"",dense:""}},[a("v-toolbar-title",[e._v("\n                    Contactos\n                ")])],1),a("v-list",{attrs:{"two-line":""}},[e._l(e.usuarios,function(t){return[a("v-list-tile",{key:t.uid,attrs:{value:e.usuarioSeleccionado&&e.usuarioSeleccionado.uid==t.uid,"active-class":"usuarios-seleccionado"},on:{click:function(a){return e.seleccionarUsuario(t)}}},[a("v-list-tile-avatar",{attrs:{size:"40"}},[a("v-img",{attrs:{src:t.url}})],1),a("v-list-tile-content",[a("v-list-tile-title",{staticClass:"moster-fond",domProps:{innerHTML:e._s(t.nombre)}}),a("v-list-tile-sub-title",{domProps:{innerHTML:e._s(e.usuario.ultimoMensaje)}})],1),t.cantidadMensajes>0?a("v-list-tile-action",[a("v-badge",{attrs:{color:"secondary",overlap:""}},[a("span",{attrs:{slot:"badge"},slot:"badge"},[e._v("\n                                    "+e._s(t.cantidadMensajes)+"\n                                ")])])],1):e._e()],1)]})],2)],1)],1):e._e(),e.mostrarChat?a("v-flex",{attrs:{xs12:"",sm8:"",lg8:""}},[a("v-container",{staticClass:"pa-0 ma-0",attrs:{"fill-height":""}},[a("v-layout",[a("v-flex",[a("v-card",{class:e.mostrarLista?"ml-3":"ml-0",attrs:{color:"#f7faff"}},[a("v-toolbar",{attrs:{color:"primary",card:"",dense:"",dark:""}},[a("v-toolbar-title",[e.esMovil?a("v-icon",{staticClass:"mr-2",on:{click:e.regresar}},[e._v("arrow_back")]):e._e(),a("v-avatar",{attrs:{color:"white",size:"32"}},[a("v-img",{attrs:{src:e.usuarioSeleccionado.url}})],1),a("span",{staticClass:"ml-3 moster-fond"},[e._v(e._s(e.usuarioSeleccionado.nombre))])],1)],1),a("v-container",{ref:"chatContainer",staticClass:"pa-0 ma-0 scroll-y"},[a("v-card-text",{style:"max-height:"+e.height+"px;"},e._l(e.chat,function(t){return a("v-flex",{key:t.mid,staticClass:"my-3",attrs:{xs7:"","offset-xs5":t.uid==e.usuario.uid}},[a("v-layout",{attrs:{column:""}},[a("div",{staticClass:"chat-fecha"},[e._v(" "+e._s(e.convertirFecha(t.fechaEnvio)))]),a("v-card",{staticClass:"chat-mensaje",attrs:{color:t.uid!=e.usuario.uid?"white":"#c3d9ff",elevation:"1"}},[a("v-card-text",[a("div",[e._v(e._s(t.texto))])])],1)],1)],1)}),1)],1),a("v-card-text",[a("v-text-field",{ref:"txtMensaje",attrs:{loading:e.enviandoMensaje,disabled:e.enviandoMensaje,solo:"","hide-details":"",label:"escriba mensaje",id:"id"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enviarMensaje()}},model:{value:e.mensaje,callback:function(t){e.mensaje=t},expression:"mensaje"}})],1)],1)],1)],1)],1)],1):e._e()],1)},O=[],N=(a("7514"),a("ac6a"),a("a481"),a("c64e")),E=a.n(N),F={props:["usuario"],data:function(){return{usuarios:[],usuarioSeleccionado:null,chat:[],mensaje:"",enviandoMensaje:!1,cid:null,detenerChat:null,height:0}},created:function(){this.cunsultarUsuarios()},mounted:function(){},computed:{esMovil:function(){return this.$vuetify.breakpoint.width<600},mostrarLista:function(){return this.usuarios&&(!this.esMovil||!this.usuarioSeleccionado)},mostrarChat:function(){return this.usuarios&&this.usuarioSeleccionado}},methods:{onRisize:function(){this.height=window.innerHeight-276},convertirFecha:function(e){return e.toDate().toISOString().substring(0,16).replace("T"," ")},consultarChat:function(){var e=this;this.chat=[],this.detenerChat&&this.detenerChat(),this.detenerChat=h.collection("contactos").doc(this.cid).collection("chat").orderBy("fechaEnvio").onSnapshot(function(t){t.docChanges().forEach(function(t){if("added"==t.type){var a=t.doc.data();e.chat.push(a),a.fechaLeido||a.uid==e.usuario.uid||e.marcarMensajeLeido(a)}e.$nextTick(function(){e.$refs.chatContainer&&(e.$refs.chatContainer.scrollTop=1e5)})})},function(){e.enviarNotificacion("ocurrio un error enviando los mensajes","error")})},marcarMensajeLeido:function(e){var t=h.batch();t.update(h.collection("contactos").doc(this.cid).collection("chat").doc(e.mid),{fechaLeido:new Date}),t.delete(h.collection("usuarios").doc(this.usuario.uid).collection("chat-sin-leer").doc(e.mid)),t.commit()},regresar:function(){this.usuarioSeleccionado=null},enviarNotificacion:function(e,t){this.$emit("onNotificacion",{mensaje:e,color:t})},generarChatId:function(e,t){return e<t?"".concat(e,"-").concat(t):"".concat(t,"-").concat(e)},cunsultarUsuarios:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.collection("usuarios").get();case 3:t=e.sent,t.forEach(function(e){var t=e.data();t.uid!==a.usuario.uid&&(t.cantidadMensajes=0,t.ultimoMensaje="",a.usuarios.push(t))}),this.consultarChatSinLeer(),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),this.enviarNotificacion("Ocurrio un error consultando tu lista de contactos","error");case 11:case"end":return e.stop()}},e,this,[[0,8]])}));function t(){return e.apply(this,arguments)}return t}(),consultarChatSinLeer:function(){var e=this;h.collection("usuarios").doc(this.usuario.uid).collection("chat-sin-leer").orderBy("fechaEnvio").onSnapshot(function(t){t.docChanges().forEach(function(t){var a=t.doc.data(),n=e.usuarios.find(function(e){return e.uid==a.uid});if(n)switch(t.type){case"added":n.cantidadMensajes++,n.ultimoMensaje=a.texto;break;case"removed":n.cantidadMensajes--,n.ultimoMensaje="",n.cantidadMensajes<0&&(n.cantidadMensajes=0);break}})},function(){e.enviarNotificacion("Ocurrio un error recuepenado mensaje sin leer"," error")})},seleccionarUsuario:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.cid=this.generarChatId(this.usuario.uid,t.uid),e.prev=1,e.next=4,h.collection("contactos").doc(this.cid).get();case 4:if(a=e.sent,a.exists){e.next=8;break}return e.next=8,h.collection("contactos").doc(this.cid).set({cid:this.cid});case 8:this.usuarioSeleccionado=t,this.consultarChat(),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),this.enviarNotificacion("ocurrio un error recuperando la informacion","error");case 15:case"end":return e.stop()}},e,this,[[1,12]])}));function t(t){return e.apply(this,arguments)}return t}(),enviarMensaje:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,a,n,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.mensaje&&!this.enviandoMensaje){e.next=2;break}return e.abrupt("return");case 2:return this.enviandoMensaje=!0,t=E()(),a={mid:t,texto:this.mensaje,fechaEnvio:new Date,uid:this.usuario.uid},n=h.batch(),n.set(h.collection("contactos").doc(this.cid).collection("chat").doc(t),a),n.set(h.collection("usuarios").doc(this.usuarioSeleccionado.uid).collection("chat-sin-leer").doc(t),a),e.prev=8,e.next=11,n.commit();case 11:this.mensaje="",e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](8),this.enviarNotificacion("Ocurrio un error enviando mensaje. intentalo nuevamente","error");case 17:return e.prev=17,this.enviandoMensaje=!1,this.$nextTick(function(){r.$refs.txtMensaje.focus()}),e.finish(17);case 21:case"end":return e.stop()}},e,this,[[8,14,17,21]])}));function t(){return e.apply(this,arguments)}return t}()}},I=F,$=(a("f196"),a("8212")),R=a("4ca6"),A=a("a523"),P=a("132d"),z=a("adda"),D=a("8860"),U=a("ba95"),B=a("40fe"),H=a("c954"),J=a("5d23"),K=a("269a"),Y=a.n(K),G=a("0d3d"),W=Object(b["a"])(I,L,O,!1,null,null,null),q=W.exports;x()(W,{VAvatar:$["a"],VBadge:R["a"],VCard:j["a"],VCardText:k["a"],VContainer:A["a"],VFlex:w["a"],VIcon:P["a"],VImg:z["a"],VLayout:C["a"],VList:D["a"],VListTile:U["a"],VListTileAction:B["a"],VListTileAvatar:H["a"],VListTileContent:J["a"],VListTileSubTitle:J["b"],VListTileTitle:J["c"],VTextField:_["a"],VToolbar:V["a"],VToolbarTitle:M["a"]}),Y()(W,{Resize:G["a"]});var Q={name:"App",components:{Login:S,Chat:q},data:function(){return{usuario:null,notificacion:{mensaje:"",color:"info",visible:!1}}},methods:{ingresar:function(e){this.usuario=e},mostarNotificacion:function(e){this.notificacion.mensaje=e.mensaje,this.notificacion.color=e.color,this.notificacion.visible=!0}}},X=Q,Z=(a("034f"),a("7496")),ee=a("549c"),te=a("553a"),ae=a("2db4"),ne=a("9910"),re=Object(b["a"])(X,i,o,!1,null,null,null),ie=re.exports;x()(re,{VApp:Z["a"],VAvatar:$["a"],VBtn:y["a"],VContainer:A["a"],VContent:ee["a"],VFooter:te["a"],VImg:z["a"],VLayout:C["a"],VSnackbar:ae["a"],VSpacer:ne["a"],VToolbar:V["a"],VToolbarTitle:M["a"]});a("d5e8"),a("d1e7");n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(ie)}}).$mount("#app")},9574:function(e,t,a){},f196:function(e,t,a){"use strict";var n=a("9574"),r=a.n(n);r.a}});
//# sourceMappingURL=app.ba952c36.js.map